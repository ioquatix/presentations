#!/usr/bin/env ruby

require 'monitor'

def middleware_mutex(&block)
	@middleware_mutex ||= Monitor.new
	@middleware_mutex.synchronize(&block)
end


threads = 10.times.collect do
	Thread.new do
		middleware_mutex do
			puts @middleware_mutex
		end
	end
end

threads.each(&:join)
