#!/usr/bin/env ruby

require 'thread'

threads = []

@cache = {}

tokens = 1000.times.map{('a'..'Z').to_a.sample(10).join}

@mutex = Mutex.new

10.times do
	threads << Thread.new do
		while true
			@mutex.synchronize do
				@cache[tokens.sample] = tokens.sample
			end
		end
	end
end

# 10.times do
# 	threads << Thread.new do
# 		while true
# 			@mutex.synchronize do
# 				@cache.delete(tokens.sample)
# 			end
# 		end
# 	end
# end

10.times do
	threads << Thread.new do
		while true
			@cache[tokens.sample]
		end
	end
end

threads.each(&:join)
